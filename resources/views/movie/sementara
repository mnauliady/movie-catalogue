<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        @vite('resources/css/app.css')
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <!-- <link
            rel="stylesheet"
            href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
        /> -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <title>Document</title>
    </head>

    <body>
        <div class="mx-auto text-center">
            <h1 class="text-xl font-bold">Movie Catalogue</h1>
        </div>
        <div class="mx-auto text-center">
            <input type="text" placeholder="Search Movie ..." id="search" />
        </div>
        <div class="mx-auto">
            <div id="main" class="flex flex-wrap">
                @foreach ($responseBody->results as $response)
                <div class="bg-cyan-100 w-1/3 p-4">
                    <div class="bg-yellow-50 text-center movie-content">
                        <div class="title">{{$response->title}}</div>
                        <img
                            class="w-96 mx-auto poster"
                            src="https://image.tmdb.org/t/p/original/{{$response->poster_path}}"
                        />
                        <div class="release">{{$response->release_date}}</div>
                        <div class="vote">{{$response->vote_average}}</div>
                    </div>
                </div>
                @endforeach
            </div>
            <div class="update flex flex-wrap"></div>
        </div>

        <script>
            $(document).ready(function () {
                fetch_customer_data();

                function fetch_customer_data(query = "") {
                    $.ajax({
                        url: "{{ route('movie.search') }}",
                        method: "GET",
                        data: { query: query },
                        dataType: "json",
                        success: function (data) {
                            for (let i = 0; i < data.results.length; i++) {
                                $(".update").append(
                                    "<div class='movie-update bg-cyan-800 w-1/4 p-4 text-lime-800 font-extrabold'><div class='bg-yellow-50 text-center movie-update-content'><div class='update-title'>" +
                                        data.results[i].title +
                                        "</div>,<div class='update-release'>" +
                                        data.results[i].release_date +
                                        "<img class='w-96 mx-auto poster' src='https://image.tmdb.org/t/p/original/" +
                                        data.results[i].poster_path +
                                        "' /></div><div class='update-vote'>" +
                                        data.results[i].vote_average +
                                        "</div></div></div>"
                                );
                            }
                        },
                    });
                }

                $(document).on("keyup", "#search", function () {
                    var query = $(this).val();
                    if (query.length >= 3) {
                        $(".update").empty();
                        $("#main").removeClass("flex flex-wrap");
                        $("#main").addClass("hidden");
                        fetch_customer_data(query);
                    } else if (query.length == 0) {
                        $(".update").empty();
                        $("#main").removeClass("hidden");
                        $("#main").addClass("flex flex-wrap");
                    }
                });
            });
        </script>
    </body>
</html>
